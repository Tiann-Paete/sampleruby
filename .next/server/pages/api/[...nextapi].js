"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/[...nextapi]";
exports.ids = ["pages/api/[...nextapi]"];
exports.modules = {

/***/ "bcrypt":
/*!*************************!*\
  !*** external "bcrypt" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("bcrypt");

/***/ }),

/***/ "jsonwebtoken":
/*!*******************************!*\
  !*** external "jsonwebtoken" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("jsonwebtoken");

/***/ }),

/***/ "mysql2/promise":
/*!*********************************!*\
  !*** external "mysql2/promise" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("mysql2/promise");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2F%5B...nextapi%5D&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5C%5B...nextapi%5D.js&middlewareConfigBase64=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2F%5B...nextapi%5D&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5C%5B...nextapi%5D.js&middlewareConfigBase64=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _src_pages_api_nextapi_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src\\pages\\api\\[...nextapi].js */ \"(api)/./src/pages/api/[...nextapi].js\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_nextapi_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_nextapi_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/[...nextapi]\",\n        pathname: \"/api/[...nextapi]\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _src_pages_api_nextapi_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRiU1Qi4uLm5leHRhcGklNUQmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZzcmMlNUNwYWdlcyU1Q2FwaSU1QyU1Qi4uLm5leHRhcGklNUQuanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDK0Q7QUFDL0Q7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLHNEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyxzREFBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ydWJ5LWxldGNob24vPzhmN2QiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3NyY1xcXFxwYWdlc1xcXFxhcGlcXFxcWy4uLm5leHRhcGldLmpzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsIFwiZGVmYXVsdFwiKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsIFwiY29uZmlnXCIpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5leHBvcnQgY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgUGFnZXNBUElSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuUEFHRVNfQVBJLFxuICAgICAgICBwYWdlOiBcIi9hcGkvWy4uLm5leHRhcGldXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvWy4uLm5leHRhcGldXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2F%5B...nextapi%5D&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5C%5B...nextapi%5D.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./src/pages/api/[...nextapi].js":
/*!***************************************!*\
  !*** ./src/pages/api/[...nextapi].js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var mysql2_promise__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mysql2/promise */ \"mysql2/promise\");\n/* harmony import */ var mysql2_promise__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mysql2_promise__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var url__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! url */ \"url\");\n/* harmony import */ var url__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(url__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! jsonwebtoken */ \"jsonwebtoken\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _utils_authMiddleware__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../utils/authMiddleware */ \"(api)/./src/utils/authMiddleware.js\");\n/* harmony import */ var bcrypt__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! bcrypt */ \"bcrypt\");\n/* harmony import */ var bcrypt__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(bcrypt__WEBPACK_IMPORTED_MODULE_4__);\n\n\n\n\n\nconst db = mysql2_promise__WEBPACK_IMPORTED_MODULE_0___default().createPool({\n    host: process.env.MYSQL_HOST,\n    port: process.env.MYSQL_PORT,\n    user: process.env.MYSQL_USER,\n    password: process.env.MYSQL_PASSWORD,\n    database: process.env.MYSQL_DATABASE,\n    waitForConnections: true,\n    connectionLimit: 10,\n    queueLimit: 0\n});\nasync function handler(req, res) {\n    const { method } = req;\n    const { pathname } = (0,url__WEBPACK_IMPORTED_MODULE_1__.parse)(req.url, true);\n    try {\n        switch(method){\n            case \"GET\":\n                if (pathname === \"/api/check-auth\") {\n                    return handleCheckAuth(req, res);\n                } else if (pathname === \"/api/acustomer\") {\n                    return (0,_utils_authMiddleware__WEBPACK_IMPORTED_MODULE_3__.authMiddleware)(handleGetCustomers)(req, res);\n                } else if (pathname === \"/api/aproducts\") {\n                    return handleGetProducts(req, res);\n                } else if (pathname === \"/api/aproduct-prices\") {\n                    return handleGetProductPrices(req, res);\n                } else if (pathname === \"/api/orders\") {\n                    return (0,_utils_authMiddleware__WEBPACK_IMPORTED_MODULE_3__.authMiddleware)(handleGetOrders)(req, res);\n                }\n                break;\n            case \"POST\":\n                if (pathname === \"/api/login\") {\n                    return handleLogIn(req, res);\n                } else if (pathname === \"/api/validate-pin\") {\n                    return handleValidatePin(req, res);\n                } else if (pathname === \"/api/logout\") {\n                    return handleLogout(req, res);\n                } else if (pathname === \"/api/acustomer\") {\n                    return (0,_utils_authMiddleware__WEBPACK_IMPORTED_MODULE_3__.authMiddleware)(handleAddCustomer)(req, res);\n                } else if (pathname === \"/api/orders\") {\n                    return (0,_utils_authMiddleware__WEBPACK_IMPORTED_MODULE_3__.authMiddleware)(handleGetOrders)(req, res);\n                } else if (pathname === \"/api/signup\") {\n                    return handlePostSignup(req, res);\n                }\n                break;\n            case \"PUT\":\n                if (pathname.startsWith(\"/api/aproduct/\")) {\n                    const id = pathname.split(\"/\").pop();\n                    return (0,_utils_authMiddleware__WEBPACK_IMPORTED_MODULE_3__.authMiddleware)(handleUpdateProduct)(req, res, id);\n                } else if (pathname.startsWith(\"/api/acustomer/\")) {\n                    const customerId = pathname.split(\"/\").pop();\n                    return (0,_utils_authMiddleware__WEBPACK_IMPORTED_MODULE_3__.authMiddleware)(handleUpdateCustomer)(req, res, customerId);\n                } else if (pathname === \"/api/orders\") {\n                    return (0,_utils_authMiddleware__WEBPACK_IMPORTED_MODULE_3__.authMiddleware)(handleAddOrder)(req, res);\n                }\n                break;\n            case \"DELETE\":\n                if (pathname.startsWith(\"/api/aproduct/\")) {\n                    const id = pathname.split(\"/\").pop();\n                    return (0,_utils_authMiddleware__WEBPACK_IMPORTED_MODULE_3__.authMiddleware)(handleDeleteProduct)(req, res, id);\n                } else if (pathname.startsWith(\"/api/acustomer/\")) {\n                    const customerId = pathname.split(\"/\").pop();\n                    return (0,_utils_authMiddleware__WEBPACK_IMPORTED_MODULE_3__.authMiddleware)(handleDeleteCustomer)(req, res, customerId);\n                }\n                break;\n            default:\n                res.setHeader(\"Allow\", [\n                    \"GET\",\n                    \"POST\",\n                    \"PUT\",\n                    \"DELETE\"\n                ]);\n                res.status(405).end(`Method ${method} Not Allowed`);\n        }\n    } catch (error) {\n        console.error(error);\n        res.status(500).json({\n            error: \"An error occurred while processing your request\"\n        });\n    }\n}\nasync function handleLogIn(req, res) {\n    const { emailaddress, password } = req.body;\n    try {\n        // Input validation\n        if (!emailaddress || !password) {\n            return res.status(400).json({\n                error: \"Email and password are required\"\n            });\n        }\n        // Query the database\n        const [result] = await db.query(\"SELECT * FROM acustomer WHERE emailaddress = ?\", [\n            emailaddress\n        ]);\n        // Check if user exists and password matches\n        if (result.length === 0 || !await bcrypt__WEBPACK_IMPORTED_MODULE_4___default().compare(password, result[0].password)) {\n            return res.status(401).json({\n                error: \"Invalid email or password\"\n            });\n        }\n        const user = result[0];\n        // Create JWT token - include customerid\n        const token = (0,jsonwebtoken__WEBPACK_IMPORTED_MODULE_2__.sign)({\n            userId: user.id,\n            customerid: user.customerid,\n            email: user.emailaddress,\n            role: user.role\n        }, process.env.JWT_SECRET, {\n            expiresIn: \"5h\"\n        });\n        // Set cookie\n        res.setHeader(\"Set-Cookie\", `token=${token}; HttpOnly; Path=/; Max-Age=18000; SameSite=Strict`);\n        // Send success response\n        res.status(200).json({\n            success: true,\n            message: \"Login successful\",\n            customerid: user.customerid,\n            user: {\n                emailaddress: user.emailaddress,\n                fullname: user.fullname,\n                role: user.role\n            }\n        });\n    } catch (error) {\n        console.error(\"Login error:\", error);\n        res.status(500).json({\n            error: \"An error occurred during login\"\n        });\n    }\n}\nfunction handleCheckAuth(req, res) {\n    const token = req.cookies.token;\n    if (!token) {\n        return res.status(200).json({\n            isAuthenticated: false\n        });\n    }\n    try {\n        const decoded = (0,jsonwebtoken__WEBPACK_IMPORTED_MODULE_2__.verify)(token, process.env.JWT_SECRET);\n        return res.status(200).json({\n            isAuthenticated: true,\n            customerid: decoded.customerid // Add this\n        });\n    } catch (error) {\n        return res.status(200).json({\n            isAuthenticated: false\n        });\n    }\n}\n// Logout\nasync function handleLogout(req, res) {\n    try {\n        // Clear the authentication cookie\n        res.setHeader(\"Set-Cookie\", \"token=; Path=/; HttpOnly; Expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Strict\");\n        // Send success response\n        res.status(200).json({\n            success: true,\n            message: \"Logout successful\"\n        });\n    } catch (error) {\n        console.error(\"Logout error:\", error);\n        res.status(500).json({\n            error: \"An error occurred during logout\"\n        });\n    }\n}\n// Signup\nasync function handlePostSignup(req, res) {\n    const { fullname, contactnumber, emailaddress, password } = req.body;\n    // Perform basic validation\n    if (!fullname || !contactnumber || !emailaddress || !password) {\n        return res.status(400).json({\n            error: \"All fields are required\",\n            missing: {\n                fullname: !fullname,\n                contactnumber: !contactnumber,\n                emailaddress: !emailaddress,\n                password: !password\n            }\n        });\n    }\n    try {\n        // Check if the user already exists\n        const [existingUser] = await db.query(\"SELECT * FROM acustomer WHERE emailaddress = ?\", [\n            emailaddress\n        ]);\n        if (existingUser.length > 0) {\n            return res.status(409).json({\n                error: \"User already exists\"\n            });\n        }\n        // Hash the password\n        const hashedPassword = await bcrypt__WEBPACK_IMPORTED_MODULE_4___default().hash(password, 10);\n        // Insert new user\n        const [result] = await db.query(\"INSERT INTO acustomer (fullname, contactnumber, emailaddress, password) VALUES (?, ?, ?, ?)\", [\n            fullname,\n            contactnumber,\n            emailaddress,\n            hashedPassword\n        ]);\n        res.status(201).json({\n            success: true,\n            message: \"Signup successful\",\n            userId: result.insertId\n        });\n    } catch (error) {\n        console.error(\"Error during signup:\", error);\n        res.status(500).json({\n            error: \"An error occurred while creating the user\"\n        });\n    }\n}\nasync function handleGetProductPrices(req, res) {\n    try {\n        const [prices] = await db.query(`\n      SELECT \n        ap.priceid,\n        ap.productid,\n        ap.weight,\n        CAST(ap.price AS DECIMAL(10,2)) as price,\n        ap.description,\n        p.imageUrl,\n        p.name as productName\n      FROM aproduct_prices ap\n      JOIN aproducts p ON ap.productid = p.productid\n    `);\n        console.log(\"Fetched prices with product data:\", prices);\n        res.status(200).json(prices);\n    } catch (error) {\n        console.error(\"Error fetching product prices:\", error);\n        res.status(500).json({\n            error: \"Error fetching product prices\"\n        });\n    }\n}\n// Update handleGetProducts to include more details\nasync function handleGetProducts(req, res) {\n    try {\n        const [products] = await db.query(`\n      SELECT \n        p.productid,\n        p.name,\n        p.description,\n        p.imageUrl,\n        p.category\n      FROM aproducts p\n    `);\n        console.log(\"Fetched products:\", products);\n        res.status(200).json(products);\n    } catch (error) {\n        console.error(\"Error fetching products:\", error);\n        res.status(500).json({\n            error: \"Error fetching products\"\n        });\n    }\n}\n// Function to generate tracking number\nfunction generateTrackingNumber() {\n    const prefix = \"LCH\"; // Prefix for Lechon\n    const timestamp = Date.now().toString().slice(-6);\n    const random = Math.floor(Math.random() * 1000).toString().padStart(3, \"0\");\n    return `${prefix}${timestamp}${random}`;\n}\nasync function handleAddOrder(req, res) {\n    const connection = await db.getConnection();\n    try {\n        await connection.beginTransaction();\n        const { customerid, items, total_amount, payment_method, delivery_address } = req.body;\n        const tracking_number = generateTrackingNumber();\n        // Get the base productid and calculate total quantity\n        const [productInfo] = await connection.query(`SELECT ap.productid \n       FROM aproduct_prices ap\n       WHERE ap.priceid = ?`, [\n            items[0]?.priceid\n        ]);\n        const baseProductId = productInfo?.[0]?.productid;\n        // Calculate total quantity for items with the same base product\n        let totalQuantity = 0;\n        for (const item of items){\n            const [priceInfo] = await connection.query(`SELECT productid FROM aproduct_prices WHERE priceid = ?`, [\n                item.priceid\n            ]);\n            if (priceInfo?.[0]?.productid === baseProductId) {\n                totalQuantity += item.quantity;\n            }\n        }\n        // Insert main order\n        const [orderResult] = await connection.query(`INSERT INTO orders (\n        tracking_number, \n        customerid, \n        productid,\n        quantity,\n        total_amount, \n        payment_method, \n        delivery_address,\n        status\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?)`, [\n            tracking_number,\n            customerid,\n            baseProductId || 0,\n            totalQuantity,\n            total_amount,\n            payment_method,\n            delivery_address,\n            \"order_placed\"\n        ]);\n        const orderid = orderResult.insertId;\n        // Insert order items\n        for (const item of items){\n            await connection.query(`INSERT INTO order_items (\n          orderid, \n          priceid, \n          quantity, \n          price_at_time\n        ) VALUES (?, ?, ?, ?)`, [\n                orderid,\n                item.priceid,\n                item.quantity,\n                item.price\n            ]);\n        }\n        await connection.commit();\n        res.status(200).json({\n            orderid,\n            tracking_number,\n            message: \"Order created successfully\"\n        });\n    } catch (error) {\n        await connection.rollback();\n        console.error(\"Error creating order:\", error);\n        res.status(500).json({\n            error: \"Error creating order\"\n        });\n    } finally{\n        connection.release();\n    }\n}\nasync function handleGetOrders(req, res) {\n    try {\n        // Modified query to include customer details from acustomer table\n        const [orders] = await db.query(`\n      SELECT \n        o.*,\n        c.fullname,\n        c.contactNumber,\n        c.emailaddress\n      FROM orders o\n      JOIN acustomer c ON o.customerid = c.customerid\n      ORDER BY o.date DESC\n    `);\n        // Fetch items for each order\n        for (let order of orders){\n            const [items] = await db.query(`\n        SELECT \n          oi.*,\n          ap.weight,\n          ap.description,\n          p.name,\n          p.imageUrl\n        FROM order_items oi\n        JOIN aproduct_prices ap ON oi.priceid = ap.priceid\n        JOIN aproducts p ON ap.productid = p.productid\n        WHERE oi.orderid = ?\n      `, [\n                order.orderid\n            ]);\n            order.items = items;\n        }\n        res.status(200).json(orders);\n    } catch (error) {\n        console.error(\"Error fetching orders:\", error);\n        res.status(500).json({\n            error: \"Error fetching orders\"\n        });\n    }\n} // Other functions (handleGetCustomers, handleAddOrder, etc.) would go here\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDOzs7Ozs7Ozs7SUFTakMsQ0FBQztRQUVELDZCQUE2QjtRQUM3QixLQUFLLElBQUkyRCxTQUFTRCxPQUFRO1lBQ3hCLE1BQU0sQ0FBQ25CLE1BQU0sR0FBRyxNQUFNM0YsR0FBR29ELEtBQUssQ0FBQyxDQUFDOzs7Ozs7Ozs7OztNQVdoQyxDQUFDLEVBQUU7Z0JBQUMyRCxNQUFNTixPQUFPO2FBQUM7WUFFbEJNLE1BQU1wQixLQUFLLEdBQUdBO1FBQ2hCO1FBRUF4RSxJQUFJeUIsTUFBTSxDQUFDLEtBQUtJLElBQUksQ0FBQzhEO0lBQ3ZCLEVBQUUsT0FBT2hFLE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLDBCQUEwQkE7UUFDeEMzQixJQUFJeUIsTUFBTSxDQUFDLEtBQUtJLElBQUksQ0FBQztZQUFFRixPQUFPO1FBQXdCO0lBQ3hEO0FBQ0YsRUFFQSwyRUFBMkUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ydWJ5LWxldGNob24vLi9zcmMvcGFnZXMvYXBpL1suLi5uZXh0YXBpXS5qcz8yODc5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBteXNxbCBmcm9tICdteXNxbDIvcHJvbWlzZSc7XG5pbXBvcnQgeyBwYXJzZSB9IGZyb20gJ3VybCc7XG5pbXBvcnQgeyBzaWduLCB2ZXJpZnkgfSBmcm9tICdqc29ud2VidG9rZW4nO1xuaW1wb3J0IHsgYXV0aE1pZGRsZXdhcmUgfSBmcm9tICcuLi8uLi91dGlscy9hdXRoTWlkZGxld2FyZSc7XG5pbXBvcnQgYmNyeXB0IGZyb20gJ2JjcnlwdCc7XG5cbmNvbnN0IGRiID0gbXlzcWwuY3JlYXRlUG9vbCh7XG4gIGhvc3Q6IHByb2Nlc3MuZW52Lk1ZU1FMX0hPU1QsXG4gIHBvcnQ6IHByb2Nlc3MuZW52Lk1ZU1FMX1BPUlQsXG4gIHVzZXI6IHByb2Nlc3MuZW52Lk1ZU1FMX1VTRVIsXG4gIHBhc3N3b3JkOiBwcm9jZXNzLmVudi5NWVNRTF9QQVNTV09SRCxcbiAgZGF0YWJhc2U6IHByb2Nlc3MuZW52Lk1ZU1FMX0RBVEFCQVNFLFxuICB3YWl0Rm9yQ29ubmVjdGlvbnM6IHRydWUsXG4gIGNvbm5lY3Rpb25MaW1pdDogMTAsXG4gIHF1ZXVlTGltaXQ6IDAsXG59KTtcblxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXEsIHJlcykge1xuICBjb25zdCB7IG1ldGhvZCB9ID0gcmVxO1xuICBjb25zdCB7IHBhdGhuYW1lIH0gPSBwYXJzZShyZXEudXJsLCB0cnVlKTtcblxuICB0cnkge1xuICAgIHN3aXRjaCAobWV0aG9kKSB7XG4gICAgICBjYXNlICdHRVQnOlxuICAgICAgICBpZiAocGF0aG5hbWUgPT09ICcvYXBpL2NoZWNrLWF1dGgnKSB7XG4gICAgICAgICAgcmV0dXJuIGhhbmRsZUNoZWNrQXV0aChyZXEsIHJlcyk7XG4gICAgICAgIH0gZWxzZSBpZiAocGF0aG5hbWUgPT09ICcvYXBpL2FjdXN0b21lcicpIHtcbiAgICAgICAgICByZXR1cm4gYXV0aE1pZGRsZXdhcmUoaGFuZGxlR2V0Q3VzdG9tZXJzKShyZXEsIHJlcyk7XG4gICAgICAgIH0gZWxzZSBpZiAocGF0aG5hbWUgPT09ICcvYXBpL2Fwcm9kdWN0cycpIHtcbiAgICAgICAgICByZXR1cm4gaGFuZGxlR2V0UHJvZHVjdHMocmVxLCByZXMpO1xuICAgICAgICB9IGVsc2UgaWYgKHBhdGhuYW1lID09PSAnL2FwaS9hcHJvZHVjdC1wcmljZXMnKSB7XG4gICAgICAgICAgcmV0dXJuIGhhbmRsZUdldFByb2R1Y3RQcmljZXMocmVxLCByZXMpO1xuICAgICAgICB9IGVsc2UgaWYgKHBhdGhuYW1lID09PSAnL2FwaS9vcmRlcnMnKSB7XG4gICAgICAgICAgcmV0dXJuIGF1dGhNaWRkbGV3YXJlKGhhbmRsZUdldE9yZGVycykocmVxLCByZXMpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrOyAgICAgXG5cbiAgICAgIGNhc2UgJ1BPU1QnOlxuICAgICAgICBpZiAocGF0aG5hbWUgPT09ICcvYXBpL2xvZ2luJykge1xuICAgICAgICAgIHJldHVybiBoYW5kbGVMb2dJbihyZXEsIHJlcyk7XG4gICAgICAgIH0gZWxzZSBpZiAocGF0aG5hbWUgPT09ICcvYXBpL3ZhbGlkYXRlLXBpbicpIHtcbiAgICAgICAgICByZXR1cm4gaGFuZGxlVmFsaWRhdGVQaW4ocmVxLCByZXMpO1xuICAgICAgICB9IGVsc2UgaWYgKHBhdGhuYW1lID09PSAnL2FwaS9sb2dvdXQnKSB7XG4gICAgICAgICAgcmV0dXJuIGhhbmRsZUxvZ291dChyZXEsIHJlcyk7XG4gICAgICAgIH0gZWxzZSBpZiAocGF0aG5hbWUgPT09ICcvYXBpL2FjdXN0b21lcicpIHtcbiAgICAgICAgICByZXR1cm4gYXV0aE1pZGRsZXdhcmUoaGFuZGxlQWRkQ3VzdG9tZXIpKHJlcSwgcmVzKTtcbiAgICAgICAgfSBlbHNlIGlmIChwYXRobmFtZSA9PT0gJy9hcGkvb3JkZXJzJykge1xuICAgICAgICAgIHJldHVybiBhdXRoTWlkZGxld2FyZShoYW5kbGVHZXRPcmRlcnMpKHJlcSwgcmVzKTtcbiAgICAgICAgfSBlbHNlIGlmIChwYXRobmFtZSA9PT0gJy9hcGkvc2lnbnVwJykge1xuICAgICAgICAgIHJldHVybiBoYW5kbGVQb3N0U2lnbnVwKHJlcSwgcmVzKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnUFVUJzpcbiAgICAgICAgaWYgKHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9hcGkvYXByb2R1Y3QvJykpIHtcbiAgICAgICAgICBjb25zdCBpZCA9IHBhdGhuYW1lLnNwbGl0KCcvJykucG9wKCk7XG4gICAgICAgICAgcmV0dXJuIGF1dGhNaWRkbGV3YXJlKGhhbmRsZVVwZGF0ZVByb2R1Y3QpKHJlcSwgcmVzLCBpZCk7XG4gICAgICAgIH0gZWxzZSBpZiAocGF0aG5hbWUuc3RhcnRzV2l0aCgnL2FwaS9hY3VzdG9tZXIvJykpIHtcbiAgICAgICAgICBjb25zdCBjdXN0b21lcklkID0gcGF0aG5hbWUuc3BsaXQoJy8nKS5wb3AoKTtcbiAgICAgICAgICByZXR1cm4gYXV0aE1pZGRsZXdhcmUoaGFuZGxlVXBkYXRlQ3VzdG9tZXIpKHJlcSwgcmVzLCBjdXN0b21lcklkKTtcbiAgICAgICAgfSBlbHNlIGlmIChwYXRobmFtZSA9PT0gJy9hcGkvb3JkZXJzJykge1xuICAgICAgICAgIHJldHVybiBhdXRoTWlkZGxld2FyZShoYW5kbGVBZGRPcmRlcikocmVxLCByZXMpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdERUxFVEUnOlxuICAgICAgICBpZiAocGF0aG5hbWUuc3RhcnRzV2l0aCgnL2FwaS9hcHJvZHVjdC8nKSkge1xuICAgICAgICAgIGNvbnN0IGlkID0gcGF0aG5hbWUuc3BsaXQoJy8nKS5wb3AoKTtcbiAgICAgICAgICByZXR1cm4gYXV0aE1pZGRsZXdhcmUoaGFuZGxlRGVsZXRlUHJvZHVjdCkocmVxLCByZXMsIGlkKTtcbiAgICAgICAgfSBlbHNlIGlmIChwYXRobmFtZS5zdGFydHNXaXRoKCcvYXBpL2FjdXN0b21lci8nKSkge1xuICAgICAgICAgIGNvbnN0IGN1c3RvbWVySWQgPSBwYXRobmFtZS5zcGxpdCgnLycpLnBvcCgpO1xuICAgICAgICAgIHJldHVybiBhdXRoTWlkZGxld2FyZShoYW5kbGVEZWxldGVDdXN0b21lcikocmVxLCByZXMsIGN1c3RvbWVySWQpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXMuc2V0SGVhZGVyKCdBbGxvdycsIFsnR0VUJywgJ1BPU1QnLCAnUFVUJywgJ0RFTEVURSddKTtcbiAgICAgICAgcmVzLnN0YXR1cyg0MDUpLmVuZChgTWV0aG9kICR7bWV0aG9kfSBOb3QgQWxsb3dlZGApO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgcHJvY2Vzc2luZyB5b3VyIHJlcXVlc3QnIH0pO1xuICB9XG59XG5cblxuYXN5bmMgZnVuY3Rpb24gaGFuZGxlTG9nSW4ocmVxLCByZXMpIHtcbiAgY29uc3QgeyBlbWFpbGFkZHJlc3MsIHBhc3N3b3JkIH0gPSByZXEuYm9keTtcblxuICB0cnkge1xuICAgIC8vIElucHV0IHZhbGlkYXRpb25cbiAgICBpZiAoIWVtYWlsYWRkcmVzcyB8fCAhcGFzc3dvcmQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnRW1haWwgYW5kIHBhc3N3b3JkIGFyZSByZXF1aXJlZCcgfSk7XG4gICAgfVxuXG4gICAgLy8gUXVlcnkgdGhlIGRhdGFiYXNlXG4gICAgY29uc3QgW3Jlc3VsdF0gPSBhd2FpdCBkYi5xdWVyeShcbiAgICAgICdTRUxFQ1QgKiBGUk9NIGFjdXN0b21lciBXSEVSRSBlbWFpbGFkZHJlc3MgPSA/JywgXG4gICAgICBbZW1haWxhZGRyZXNzXVxuICAgICk7XG5cbiAgICAvLyBDaGVjayBpZiB1c2VyIGV4aXN0cyBhbmQgcGFzc3dvcmQgbWF0Y2hlc1xuICAgIGlmIChyZXN1bHQubGVuZ3RoID09PSAwIHx8ICEoYXdhaXQgYmNyeXB0LmNvbXBhcmUocGFzc3dvcmQsIHJlc3VsdFswXS5wYXNzd29yZCkpKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ0ludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQnIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHVzZXIgPSByZXN1bHRbMF07XG4gICAgXG4gICAgLy8gQ3JlYXRlIEpXVCB0b2tlbiAtIGluY2x1ZGUgY3VzdG9tZXJpZFxuICAgIGNvbnN0IHRva2VuID0gc2lnbihcbiAgICAgIHsgXG4gICAgICAgIHVzZXJJZDogdXNlci5pZCwgXG4gICAgICAgIGN1c3RvbWVyaWQ6IHVzZXIuY3VzdG9tZXJpZCwgLy8gQWRkIHRoaXNcbiAgICAgICAgZW1haWw6IHVzZXIuZW1haWxhZGRyZXNzLCBcbiAgICAgICAgcm9sZTogdXNlci5yb2xlIFxuICAgICAgfSwgXG4gICAgICBwcm9jZXNzLmVudi5KV1RfU0VDUkVULCBcbiAgICAgIHsgZXhwaXJlc0luOiAnNWgnIH1cbiAgICApO1xuXG4gICAgLy8gU2V0IGNvb2tpZVxuICAgIHJlcy5zZXRIZWFkZXIoXG4gICAgICAnU2V0LUNvb2tpZScsIFxuICAgICAgYHRva2VuPSR7dG9rZW59OyBIdHRwT25seTsgUGF0aD0vOyBNYXgtQWdlPTE4MDAwOyBTYW1lU2l0ZT1TdHJpY3RgXG4gICAgKTtcblxuICAgIC8vIFNlbmQgc3VjY2VzcyByZXNwb25zZVxuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgXG4gICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgIG1lc3NhZ2U6ICdMb2dpbiBzdWNjZXNzZnVsJyxcbiAgICAgIGN1c3RvbWVyaWQ6IHVzZXIuY3VzdG9tZXJpZCwgLy8gQWRkIHRoaXNcbiAgICAgIHVzZXI6IHtcbiAgICAgICAgZW1haWxhZGRyZXNzOiB1c2VyLmVtYWlsYWRkcmVzcyxcbiAgICAgICAgZnVsbG5hbWU6IHVzZXIuZnVsbG5hbWUsXG4gICAgICAgIHJvbGU6IHVzZXIucm9sZVxuICAgICAgfVxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0xvZ2luIGVycm9yOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnQW4gZXJyb3Igb2NjdXJyZWQgZHVyaW5nIGxvZ2luJyB9KTtcbiAgfVxufVxuXG5cblxuZnVuY3Rpb24gaGFuZGxlQ2hlY2tBdXRoKHJlcSwgcmVzKSB7XG4gIGNvbnN0IHRva2VuID0gcmVxLmNvb2tpZXMudG9rZW47XG5cbiAgaWYgKCF0b2tlbikge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IGlzQXV0aGVudGljYXRlZDogZmFsc2UgfSk7XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IGRlY29kZWQgPSB2ZXJpZnkodG9rZW4sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQpO1xuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IFxuICAgICAgaXNBdXRoZW50aWNhdGVkOiB0cnVlLFxuICAgICAgY3VzdG9tZXJpZDogZGVjb2RlZC5jdXN0b21lcmlkIC8vIEFkZCB0aGlzXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgaXNBdXRoZW50aWNhdGVkOiBmYWxzZSB9KTtcbiAgfVxufVxuXG5cbi8vIExvZ291dFxuYXN5bmMgZnVuY3Rpb24gaGFuZGxlTG9nb3V0KHJlcSwgcmVzKSB7XG4gIHRyeSB7XG4gICAgLy8gQ2xlYXIgdGhlIGF1dGhlbnRpY2F0aW9uIGNvb2tpZVxuICAgIHJlcy5zZXRIZWFkZXIoXG4gICAgICAnU2V0LUNvb2tpZScsXG4gICAgICAndG9rZW49OyBQYXRoPS87IEh0dHBPbmx5OyBFeHBpcmVzPVRodSwgMDEgSmFuIDE5NzAgMDA6MDA6MDAgR01UOyBTYW1lU2l0ZT1TdHJpY3QnXG4gICAgKTtcblxuICAgIC8vIFNlbmQgc3VjY2VzcyByZXNwb25zZVxuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZTogJ0xvZ291dCBzdWNjZXNzZnVsJyB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdMb2dvdXQgZXJyb3I6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdBbiBlcnJvciBvY2N1cnJlZCBkdXJpbmcgbG9nb3V0JyB9KTtcbiAgfVxufVxuXG5cbi8vIFNpZ251cFxuYXN5bmMgZnVuY3Rpb24gaGFuZGxlUG9zdFNpZ251cChyZXEsIHJlcykge1xuICBjb25zdCB7IGZ1bGxuYW1lLCBjb250YWN0bnVtYmVyLCBlbWFpbGFkZHJlc3MsIHBhc3N3b3JkIH0gPSByZXEuYm9keTtcblxuICAvLyBQZXJmb3JtIGJhc2ljIHZhbGlkYXRpb25cbiAgaWYgKCFmdWxsbmFtZSB8fCAhY29udGFjdG51bWJlciB8fCAhZW1haWxhZGRyZXNzIHx8ICFwYXNzd29yZCkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IFxuICAgICAgZXJyb3I6ICdBbGwgZmllbGRzIGFyZSByZXF1aXJlZCcsXG4gICAgICBtaXNzaW5nOiB7XG4gICAgICAgIGZ1bGxuYW1lOiAhZnVsbG5hbWUsXG4gICAgICAgIGNvbnRhY3RudW1iZXI6ICFjb250YWN0bnVtYmVyLFxuICAgICAgICBlbWFpbGFkZHJlc3M6ICFlbWFpbGFkZHJlc3MsXG4gICAgICAgIHBhc3N3b3JkOiAhcGFzc3dvcmRcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgLy8gQ2hlY2sgaWYgdGhlIHVzZXIgYWxyZWFkeSBleGlzdHNcbiAgICBjb25zdCBbZXhpc3RpbmdVc2VyXSA9IGF3YWl0IGRiLnF1ZXJ5KFxuICAgICAgJ1NFTEVDVCAqIEZST00gYWN1c3RvbWVyIFdIRVJFIGVtYWlsYWRkcmVzcyA9ID8nLCBcbiAgICAgIFtlbWFpbGFkZHJlc3NdXG4gICAgKTtcbiAgICBcbiAgICBpZiAoZXhpc3RpbmdVc2VyLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwOSkuanNvbih7IGVycm9yOiAnVXNlciBhbHJlYWR5IGV4aXN0cycgfSk7XG4gICAgfVxuXG4gICAgLy8gSGFzaCB0aGUgcGFzc3dvcmRcbiAgICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IGF3YWl0IGJjcnlwdC5oYXNoKHBhc3N3b3JkLCAxMCk7XG5cbiAgICAvLyBJbnNlcnQgbmV3IHVzZXJcbiAgICBjb25zdCBbcmVzdWx0XSA9IGF3YWl0IGRiLnF1ZXJ5KFxuICAgICAgJ0lOU0VSVCBJTlRPIGFjdXN0b21lciAoZnVsbG5hbWUsIGNvbnRhY3RudW1iZXIsIGVtYWlsYWRkcmVzcywgcGFzc3dvcmQpIFZBTFVFUyAoPywgPywgPywgPyknLFxuICAgICAgW2Z1bGxuYW1lLCBjb250YWN0bnVtYmVyLCBlbWFpbGFkZHJlc3MsIGhhc2hlZFBhc3N3b3JkXVxuICAgICk7XG5cbiAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7IFxuICAgICAgc3VjY2VzczogdHJ1ZSwgXG4gICAgICBtZXNzYWdlOiAnU2lnbnVwIHN1Y2Nlc3NmdWwnLCBcbiAgICAgIHVzZXJJZDogcmVzdWx0Lmluc2VydElkIFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkdXJpbmcgc2lnbnVwOlwiLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ0FuIGVycm9yIG9jY3VycmVkIHdoaWxlIGNyZWF0aW5nIHRoZSB1c2VyJyB9KTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVHZXRQcm9kdWN0UHJpY2VzKHJlcSwgcmVzKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgW3ByaWNlc10gPSBhd2FpdCBkYi5xdWVyeShgXG4gICAgICBTRUxFQ1QgXG4gICAgICAgIGFwLnByaWNlaWQsXG4gICAgICAgIGFwLnByb2R1Y3RpZCxcbiAgICAgICAgYXAud2VpZ2h0LFxuICAgICAgICBDQVNUKGFwLnByaWNlIEFTIERFQ0lNQUwoMTAsMikpIGFzIHByaWNlLFxuICAgICAgICBhcC5kZXNjcmlwdGlvbixcbiAgICAgICAgcC5pbWFnZVVybCxcbiAgICAgICAgcC5uYW1lIGFzIHByb2R1Y3ROYW1lXG4gICAgICBGUk9NIGFwcm9kdWN0X3ByaWNlcyBhcFxuICAgICAgSk9JTiBhcHJvZHVjdHMgcCBPTiBhcC5wcm9kdWN0aWQgPSBwLnByb2R1Y3RpZFxuICAgIGApO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKCdGZXRjaGVkIHByaWNlcyB3aXRoIHByb2R1Y3QgZGF0YTonLCBwcmljZXMpO1xuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHByaWNlcyk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcHJvZHVjdCBwcmljZXM6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdFcnJvciBmZXRjaGluZyBwcm9kdWN0IHByaWNlcycgfSk7XG4gIH1cbn1cblxuLy8gVXBkYXRlIGhhbmRsZUdldFByb2R1Y3RzIHRvIGluY2x1ZGUgbW9yZSBkZXRhaWxzXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVHZXRQcm9kdWN0cyhyZXEsIHJlcykge1xuICB0cnkge1xuICAgIGNvbnN0IFtwcm9kdWN0c10gPSBhd2FpdCBkYi5xdWVyeShgXG4gICAgICBTRUxFQ1QgXG4gICAgICAgIHAucHJvZHVjdGlkLFxuICAgICAgICBwLm5hbWUsXG4gICAgICAgIHAuZGVzY3JpcHRpb24sXG4gICAgICAgIHAuaW1hZ2VVcmwsXG4gICAgICAgIHAuY2F0ZWdvcnlcbiAgICAgIEZST00gYXByb2R1Y3RzIHBcbiAgICBgKTtcbiAgICBjb25zb2xlLmxvZygnRmV0Y2hlZCBwcm9kdWN0czonLCBwcm9kdWN0cyk7XG4gICAgcmVzLnN0YXR1cygyMDApLmpzb24ocHJvZHVjdHMpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHByb2R1Y3RzOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnRXJyb3IgZmV0Y2hpbmcgcHJvZHVjdHMnIH0pO1xuICB9XG59XG5cblxuLy8gRnVuY3Rpb24gdG8gZ2VuZXJhdGUgdHJhY2tpbmcgbnVtYmVyXG5mdW5jdGlvbiBnZW5lcmF0ZVRyYWNraW5nTnVtYmVyKCkge1xuICBjb25zdCBwcmVmaXggPSAnTENIJzsgLy8gUHJlZml4IGZvciBMZWNob25cbiAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKS50b1N0cmluZygpLnNsaWNlKC02KTtcbiAgY29uc3QgcmFuZG9tID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMCkudG9TdHJpbmcoKS5wYWRTdGFydCgzLCAnMCcpO1xuICByZXR1cm4gYCR7cHJlZml4fSR7dGltZXN0YW1wfSR7cmFuZG9tfWA7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUFkZE9yZGVyKHJlcSwgcmVzKSB7XG4gIGNvbnN0IGNvbm5lY3Rpb24gPSBhd2FpdCBkYi5nZXRDb25uZWN0aW9uKCk7XG4gIHRyeSB7XG4gICAgYXdhaXQgY29ubmVjdGlvbi5iZWdpblRyYW5zYWN0aW9uKCk7XG5cbiAgICBjb25zdCB7IFxuICAgICAgY3VzdG9tZXJpZCxcbiAgICAgIGl0ZW1zLFxuICAgICAgdG90YWxfYW1vdW50LFxuICAgICAgcGF5bWVudF9tZXRob2QsXG4gICAgICBkZWxpdmVyeV9hZGRyZXNzXG4gICAgfSA9IHJlcS5ib2R5O1xuXG4gICAgY29uc3QgdHJhY2tpbmdfbnVtYmVyID0gZ2VuZXJhdGVUcmFja2luZ051bWJlcigpO1xuXG4gICAgLy8gR2V0IHRoZSBiYXNlIHByb2R1Y3RpZCBhbmQgY2FsY3VsYXRlIHRvdGFsIHF1YW50aXR5XG4gICAgY29uc3QgW3Byb2R1Y3RJbmZvXSA9IGF3YWl0IGNvbm5lY3Rpb24ucXVlcnkoXG4gICAgICBgU0VMRUNUIGFwLnByb2R1Y3RpZCBcbiAgICAgICBGUk9NIGFwcm9kdWN0X3ByaWNlcyBhcFxuICAgICAgIFdIRVJFIGFwLnByaWNlaWQgPSA/YCxcbiAgICAgIFtpdGVtc1swXT8ucHJpY2VpZF1cbiAgICApO1xuXG4gICAgY29uc3QgYmFzZVByb2R1Y3RJZCA9IHByb2R1Y3RJbmZvPy5bMF0/LnByb2R1Y3RpZDtcbiAgICBcbiAgICAvLyBDYWxjdWxhdGUgdG90YWwgcXVhbnRpdHkgZm9yIGl0ZW1zIHdpdGggdGhlIHNhbWUgYmFzZSBwcm9kdWN0XG4gICAgbGV0IHRvdGFsUXVhbnRpdHkgPSAwO1xuICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykge1xuICAgICAgY29uc3QgW3ByaWNlSW5mb10gPSBhd2FpdCBjb25uZWN0aW9uLnF1ZXJ5KFxuICAgICAgICBgU0VMRUNUIHByb2R1Y3RpZCBGUk9NIGFwcm9kdWN0X3ByaWNlcyBXSEVSRSBwcmljZWlkID0gP2AsXG4gICAgICAgIFtpdGVtLnByaWNlaWRdXG4gICAgICApO1xuICAgICAgXG4gICAgICBpZiAocHJpY2VJbmZvPy5bMF0/LnByb2R1Y3RpZCA9PT0gYmFzZVByb2R1Y3RJZCkge1xuICAgICAgICB0b3RhbFF1YW50aXR5ICs9IGl0ZW0ucXVhbnRpdHk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gSW5zZXJ0IG1haW4gb3JkZXJcbiAgICBjb25zdCBbb3JkZXJSZXN1bHRdID0gYXdhaXQgY29ubmVjdGlvbi5xdWVyeShcbiAgICAgIGBJTlNFUlQgSU5UTyBvcmRlcnMgKFxuICAgICAgICB0cmFja2luZ19udW1iZXIsIFxuICAgICAgICBjdXN0b21lcmlkLCBcbiAgICAgICAgcHJvZHVjdGlkLFxuICAgICAgICBxdWFudGl0eSxcbiAgICAgICAgdG90YWxfYW1vdW50LCBcbiAgICAgICAgcGF5bWVudF9tZXRob2QsIFxuICAgICAgICBkZWxpdmVyeV9hZGRyZXNzLFxuICAgICAgICBzdGF0dXNcbiAgICAgICkgVkFMVUVTICg/LCA/LCA/LCA/LCA/LCA/LCA/LCA/KWAsXG4gICAgICBbXG4gICAgICAgIHRyYWNraW5nX251bWJlciwgXG4gICAgICAgIGN1c3RvbWVyaWQsXG4gICAgICAgIGJhc2VQcm9kdWN0SWQgfHwgMCwgIC8vIFVzZSB0aGUgYWN0dWFsIHByb2R1Y3RpZCBmcm9tIGFwcm9kdWN0c1xuICAgICAgICB0b3RhbFF1YW50aXR5LCAgICAgICAvLyBUb3RhbCBxdWFudGl0eSBmb3IgdGhpcyBwcm9kdWN0XG4gICAgICAgIHRvdGFsX2Ftb3VudCwgXG4gICAgICAgIHBheW1lbnRfbWV0aG9kLCBcbiAgICAgICAgZGVsaXZlcnlfYWRkcmVzcyxcbiAgICAgICAgJ29yZGVyX3BsYWNlZCdcbiAgICAgIF1cbiAgICApO1xuXG4gICAgY29uc3Qgb3JkZXJpZCA9IG9yZGVyUmVzdWx0Lmluc2VydElkO1xuXG4gICAgLy8gSW5zZXJ0IG9yZGVyIGl0ZW1zXG4gICAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zKSB7XG4gICAgICBhd2FpdCBjb25uZWN0aW9uLnF1ZXJ5KFxuICAgICAgICBgSU5TRVJUIElOVE8gb3JkZXJfaXRlbXMgKFxuICAgICAgICAgIG9yZGVyaWQsIFxuICAgICAgICAgIHByaWNlaWQsIFxuICAgICAgICAgIHF1YW50aXR5LCBcbiAgICAgICAgICBwcmljZV9hdF90aW1lXG4gICAgICAgICkgVkFMVUVTICg/LCA/LCA/LCA/KWAsXG4gICAgICAgIFtcbiAgICAgICAgICBvcmRlcmlkLCBcbiAgICAgICAgICBpdGVtLnByaWNlaWQsIFxuICAgICAgICAgIGl0ZW0ucXVhbnRpdHksIFxuICAgICAgICAgIGl0ZW0ucHJpY2VcbiAgICAgICAgXVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBhd2FpdCBjb25uZWN0aW9uLmNvbW1pdCgpO1xuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgXG4gICAgICBvcmRlcmlkLCBcbiAgICAgIHRyYWNraW5nX251bWJlcixcbiAgICAgIG1lc3NhZ2U6ICdPcmRlciBjcmVhdGVkIHN1Y2Nlc3NmdWxseScgXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgYXdhaXQgY29ubmVjdGlvbi5yb2xsYmFjaygpO1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIG9yZGVyOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnRXJyb3IgY3JlYXRpbmcgb3JkZXInIH0pO1xuICB9IGZpbmFsbHkge1xuICAgIGNvbm5lY3Rpb24ucmVsZWFzZSgpO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUdldE9yZGVycyhyZXEsIHJlcykge1xuICB0cnkge1xuICAgIC8vIE1vZGlmaWVkIHF1ZXJ5IHRvIGluY2x1ZGUgY3VzdG9tZXIgZGV0YWlscyBmcm9tIGFjdXN0b21lciB0YWJsZVxuICAgIGNvbnN0IFtvcmRlcnNdID0gYXdhaXQgZGIucXVlcnkoYFxuICAgICAgU0VMRUNUIFxuICAgICAgICBvLiosXG4gICAgICAgIGMuZnVsbG5hbWUsXG4gICAgICAgIGMuY29udGFjdE51bWJlcixcbiAgICAgICAgYy5lbWFpbGFkZHJlc3NcbiAgICAgIEZST00gb3JkZXJzIG9cbiAgICAgIEpPSU4gYWN1c3RvbWVyIGMgT04gby5jdXN0b21lcmlkID0gYy5jdXN0b21lcmlkXG4gICAgICBPUkRFUiBCWSBvLmRhdGUgREVTQ1xuICAgIGApO1xuXG4gICAgLy8gRmV0Y2ggaXRlbXMgZm9yIGVhY2ggb3JkZXJcbiAgICBmb3IgKGxldCBvcmRlciBvZiBvcmRlcnMpIHtcbiAgICAgIGNvbnN0IFtpdGVtc10gPSBhd2FpdCBkYi5xdWVyeShgXG4gICAgICAgIFNFTEVDVCBcbiAgICAgICAgICBvaS4qLFxuICAgICAgICAgIGFwLndlaWdodCxcbiAgICAgICAgICBhcC5kZXNjcmlwdGlvbixcbiAgICAgICAgICBwLm5hbWUsXG4gICAgICAgICAgcC5pbWFnZVVybFxuICAgICAgICBGUk9NIG9yZGVyX2l0ZW1zIG9pXG4gICAgICAgIEpPSU4gYXByb2R1Y3RfcHJpY2VzIGFwIE9OIG9pLnByaWNlaWQgPSBhcC5wcmljZWlkXG4gICAgICAgIEpPSU4gYXByb2R1Y3RzIHAgT04gYXAucHJvZHVjdGlkID0gcC5wcm9kdWN0aWRcbiAgICAgICAgV0hFUkUgb2kub3JkZXJpZCA9ID9cbiAgICAgIGAsIFtvcmRlci5vcmRlcmlkXSk7XG4gICAgICBcbiAgICAgIG9yZGVyLml0ZW1zID0gaXRlbXM7XG4gICAgfVxuXG4gICAgcmVzLnN0YXR1cygyMDApLmpzb24ob3JkZXJzKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBvcmRlcnM6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdFcnJvciBmZXRjaGluZyBvcmRlcnMnIH0pO1xuICB9XG59XG5cbi8vIE90aGVyIGZ1bmN0aW9ucyAoaGFuZGxlR2V0Q3VzdG9tZXJzLCBoYW5kbGVBZGRPcmRlciwgZXRjLikgd291bGQgZ28gaGVyZSJdLCJuYW1lcyI6WyJteXNxbCIsInBhcnNlIiwic2lnbiIsInZlcmlmeSIsImF1dGhNaWRkbGV3YXJlIiwiYmNyeXB0IiwiZGIiLCJjcmVhdGVQb29sIiwiaG9zdCIsInByb2Nlc3MiLCJlbnYiLCJNWVNRTF9IT1NUIiwicG9ydCIsIk1ZU1FMX1BPUlQiLCJ1c2VyIiwiTVlTUUxfVVNFUiIsInBhc3N3b3JkIiwiTVlTUUxfUEFTU1dPUkQiLCJkYXRhYmFzZSIsIk1ZU1FMX0RBVEFCQVNFIiwid2FpdEZvckNvbm5lY3Rpb25zIiwiY29ubmVjdGlvbkxpbWl0IiwicXVldWVMaW1pdCIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJwYXRobmFtZSIsInVybCIsImhhbmRsZUNoZWNrQXV0aCIsImhhbmRsZUdldEN1c3RvbWVycyIsImhhbmRsZUdldFByb2R1Y3RzIiwiaGFuZGxlR2V0UHJvZHVjdFByaWNlcyIsImhhbmRsZUdldE9yZGVycyIsImhhbmRsZUxvZ0luIiwiaGFuZGxlVmFsaWRhdGVQaW4iLCJoYW5kbGVMb2dvdXQiLCJoYW5kbGVBZGRDdXN0b21lciIsImhhbmRsZVBvc3RTaWdudXAiLCJzdGFydHNXaXRoIiwiaWQiLCJzcGxpdCIsInBvcCIsImhhbmRsZVVwZGF0ZVByb2R1Y3QiLCJjdXN0b21lcklkIiwiaGFuZGxlVXBkYXRlQ3VzdG9tZXIiLCJoYW5kbGVBZGRPcmRlciIsImhhbmRsZURlbGV0ZVByb2R1Y3QiLCJoYW5kbGVEZWxldGVDdXN0b21lciIsInNldEhlYWRlciIsInN0YXR1cyIsImVuZCIsImVycm9yIiwiY29uc29sZSIsImpzb24iLCJlbWFpbGFkZHJlc3MiLCJib2R5IiwicmVzdWx0IiwicXVlcnkiLCJsZW5ndGgiLCJjb21wYXJlIiwidG9rZW4iLCJ1c2VySWQiLCJjdXN0b21lcmlkIiwiZW1haWwiLCJyb2xlIiwiSldUX1NFQ1JFVCIsImV4cGlyZXNJbiIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwiZnVsbG5hbWUiLCJjb29raWVzIiwiaXNBdXRoZW50aWNhdGVkIiwiZGVjb2RlZCIsImNvbnRhY3RudW1iZXIiLCJtaXNzaW5nIiwiZXhpc3RpbmdVc2VyIiwiaGFzaGVkUGFzc3dvcmQiLCJoYXNoIiwiaW5zZXJ0SWQiLCJwcmljZXMiLCJsb2ciLCJwcm9kdWN0cyIsImdlbmVyYXRlVHJhY2tpbmdOdW1iZXIiLCJwcmVmaXgiLCJ0aW1lc3RhbXAiLCJEYXRlIiwibm93IiwidG9TdHJpbmciLCJzbGljZSIsInJhbmRvbSIsIk1hdGgiLCJmbG9vciIsInBhZFN0YXJ0IiwiY29ubmVjdGlvbiIsImdldENvbm5lY3Rpb24iLCJiZWdpblRyYW5zYWN0aW9uIiwiaXRlbXMiLCJ0b3RhbF9hbW91bnQiLCJwYXltZW50X21ldGhvZCIsImRlbGl2ZXJ5X2FkZHJlc3MiLCJ0cmFja2luZ19udW1iZXIiLCJwcm9kdWN0SW5mbyIsInByaWNlaWQiLCJiYXNlUHJvZHVjdElkIiwicHJvZHVjdGlkIiwidG90YWxRdWFudGl0eSIsIml0ZW0iLCJwcmljZUluZm8iLCJxdWFudGl0eSIsIm9yZGVyUmVzdWx0Iiwib3JkZXJpZCIsInByaWNlIiwiY29tbWl0Iiwicm9sbGJhY2siLCJyZWxlYXNlIiwib3JkZXJzIiwib3JkZXIiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/pages/api/[...nextapi].js\n");

/***/ }),

/***/ "(api)/./src/utils/authMiddleware.js":
/*!*************************************!*\
  !*** ./src/utils/authMiddleware.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authMiddleware: () => (/* binding */ authMiddleware)\n/* harmony export */ });\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jsonwebtoken */ \"jsonwebtoken\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__);\n\nfunction authMiddleware(handler) {\n    return async (req, res)=>{\n        try {\n            const token = req.cookies.token;\n            if (!token) {\n                return res.status(401).json({\n                    error: \"Authentication required\"\n                });\n            }\n            const decoded = (0,jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__.verify)(token, process.env.JWT_SECRET);\n            req.userId = decoded.userId;\n            return handler(req, res);\n        } catch (error) {\n            console.error(\"Authentication error:\", error);\n            return res.status(401).json({\n                error: \"Invalid or expired token\"\n            });\n        }\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvdXRpbHMvYXV0aE1pZGRsZXdhcmUuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQXNDO0FBRS9CLFNBQVNDLGVBQWVDLE9BQU87SUFDcEMsT0FBTyxPQUFPQyxLQUFLQztRQUNqQixJQUFJO1lBQ0YsTUFBTUMsUUFBUUYsSUFBSUcsT0FBTyxDQUFDRCxLQUFLO1lBRS9CLElBQUksQ0FBQ0EsT0FBTztnQkFDVixPQUFPRCxJQUFJRyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO29CQUFFQyxPQUFPO2dCQUEwQjtZQUNqRTtZQUVBLE1BQU1DLFVBQVVWLG9EQUFNQSxDQUFDSyxPQUFPTSxRQUFRQyxHQUFHLENBQUNDLFVBQVU7WUFDcERWLElBQUlXLE1BQU0sR0FBR0osUUFBUUksTUFBTTtZQUUzQixPQUFPWixRQUFRQyxLQUFLQztRQUN0QixFQUFFLE9BQU9LLE9BQU87WUFDZE0sUUFBUU4sS0FBSyxDQUFDLHlCQUF5QkE7WUFDdkMsT0FBT0wsSUFBSUcsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUEyQjtRQUNsRTtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ydWJ5LWxldGNob24vLi9zcmMvdXRpbHMvYXV0aE1pZGRsZXdhcmUuanM/N2M2MCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB2ZXJpZnkgfSBmcm9tICdqc29ud2VidG9rZW4nO1xuXG5leHBvcnQgZnVuY3Rpb24gYXV0aE1pZGRsZXdhcmUoaGFuZGxlcikge1xuICByZXR1cm4gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHRva2VuID0gcmVxLmNvb2tpZXMudG9rZW47XG5cbiAgICAgIGlmICghdG9rZW4pIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGRlY29kZWQgPSB2ZXJpZnkodG9rZW4sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQpO1xuICAgICAgcmVxLnVzZXJJZCA9IGRlY29kZWQudXNlcklkO1xuXG4gICAgICByZXR1cm4gaGFuZGxlcihyZXEsIHJlcyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0F1dGhlbnRpY2F0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnSW52YWxpZCBvciBleHBpcmVkIHRva2VuJyB9KTtcbiAgICB9XG4gIH07XG59Il0sIm5hbWVzIjpbInZlcmlmeSIsImF1dGhNaWRkbGV3YXJlIiwiaGFuZGxlciIsInJlcSIsInJlcyIsInRva2VuIiwiY29va2llcyIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsImRlY29kZWQiLCJwcm9jZXNzIiwiZW52IiwiSldUX1NFQ1JFVCIsInVzZXJJZCIsImNvbnNvbGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/utils/authMiddleware.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2F%5B...nextapi%5D&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5C%5B...nextapi%5D.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();